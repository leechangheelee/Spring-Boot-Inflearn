## **스프링 부트 활용**
  * 스프링 시큐리티 - Starter-Security
    * 스프링 시큐리티
      * 웹 시큐리티
      * 메소드 시큐리티
      * 다양한 인증 방법 지원
        * LDAP, 폼 인증, Basic 인증, OAuth, ...
    * 스프링 부트 시큐리티 자동설정
      * SecurityAutoConfiguration
      * UserDetailsServiceAutoConfiguration ← 기본 사용자 생성해줌
      * spring-boot-starter-security
        * 스프링 시큐리티 5.* 의존성 추가
          ```xml
          <!-- pom.xml -->
          <dependency>
              <groupId>org.springframework.boot</groupId>
              <artifactId>spring-boot-starter-security</artifactId>
          </dependency>
          ```
      * 모든 요청에 인증이 필요함
      * 기본 사용자 생성
        * Username : user
        * Password : 애플리케이션을 실행할 때 마다 랜덤 값 생성 (콘솔에 출력 됨)
        * spring.security.user.name
        * spring.security.user.password
      * 인증 관련 각종 이벤트 발생
        * DefaultAuthenticationEventPublisher 빈 등록
        * 다양한 인증 에러 핸들러 등록 가능
    * 스프링 부트 시큐리티 테스트
      * https://docs.spring.io/spring-security/reference/servlet/test/method.html#test-method-setup
      ```xml
      <!-- pom.xml -->
      <dependency>
          <groupId>org.springframework.security</groupId>
          <artifactId>spring-security-test</artifactId>
          <version>${spring-security.version}</version>
          <scope>test</scope>
      </dependency>
      ```
    ```xml
    <!-- pom.xml -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-thymeleaf</artifactId>
    </dependency>
    ```
    ```html
    <!-- index.html -->
    ...
    <h1>Welcome</h1>
    <a href="/hello">hello</a>
    <a href="/my">my page</a>
    </body>
    </html>
    ```
    ```html
    <!-- hello.html -->
    ...
    <h1>Hello</h1>
    ...
    ```
    ```html
    <!-- my.html -->
    ...
    <h1>My</h1>
    ...
    ```
    ```java
    /* HomeController.java */
    ...
    @Controller
    public class HomeController {

        @GetMapping("/hello")
        public String hello() {
            return "hello";
        }

        @GetMapping("/my")
        public String my() {
            return "my";
        }
    }
    ```
    ```java
    /* WebConfig.java (간단 뷰 리턴 샘플코드) */
    ...
    @Configuration
    public class WebConfig implements WebMvcConfigurer {

        @Override
        public void addViewControllers(ViewControllerRegistry registry) {
            registry.addViewController("/helloCH").setViewName("helloCH"); // 요렇게 하면 아래 주석 코드와 동일하게 처리 가능
        }

        /*
        @Controller
        public class HomeController {

            @GetMapping("/helloCH")
            public String hello() {
                return "helloCH";
            }
        }
         */
    }
    ```
    ```java
    /* WebSecurityConfig.java */
    ...
    @Configuration
    public class WebSecurityConfig extends WebSecurityConfigurerAdapter {

    }
    ```
    ```java
    /* HomeControllerTest.java */
    ...
    @RunWith(SpringRunner.class)
    @WebMvcTest(HomeController.class)
    public class HomeControllerTest {

        /*
        spring security 를 의존성에 추가하면 401 Unauthorized 응답 (... Headers = {WWW-Authenticate=[Basic realm="Realm"] ...)이 옴 (basic authentication 요구)
        → 스프링 부트가 제공하는 security 자동설정 중 하나. 모든 요청이 스프링 security로 인해 인증을 필요로 하게 됨
        → 또 다른 하나는 basic authentication 이랑 form 인증이 둘다 적용이 됨

        Basic Authenticate 응답을 받으면 브라우저에서 안이쁜 팝업창을 통해 유저 패스워드 입력하게 함
        Basic 인증은 Accept 헤더 (요청이 원하는 응답의 형태) 에 따라 달라짐
            Accept 헤더도 설정 가능함
            Accept 헤더를 HTML 을 원한다 - 요게 기본적으로 웹브라우저가 요청 보낼때 헤더에 들어있는 값 (text/html). 그런 경우 form 인증으로 넘어가게 되어있음
         */

        @Autowired
        MockMvc mockMvc;

        @Test
        @WithMockUser // Spring Security 테스트용 유저 모킹
        public void hello() throws Exception {
            mockMvc.perform(get("/hello")
                            .accept(MediaType.TEXT_HTML))
                    .andDo(print()) // print를 먼저 하는게 좋음. 테스트를 실패하더라도 어떤 응답이 나온 상태에서 실패한지 파악가능 (테스트 실패시에 기본으로 print 해주긴 함)
                    .andExpect(status().isOk())
                    .andExpect(view().name("hello"))
            ;
        }

        @Test
        public void hello_without_user() throws Exception {
            mockMvc.perform(get("/hello"))
                    .andDo(print())
                    .andExpect(status().isUnauthorized())
            ;
        }

        @Test
        @WithMockUser
        public void my() throws Exception {
            mockMvc.perform(get("/my"))
                    .andDo(print())
                    .andExpect(status().isOk())
                    .andExpect(view().name("my"))
            ;
        }
    }
    ```
***
  * 스프링 시큐리티 - 시큐리티 설정 커스터마이징
    * 참고
